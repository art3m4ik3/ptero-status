"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Register=void 0;const jspteroapi_1=require("jspteroapi"),Command_1=require("../classes/Command");class Register{constructor(e){this.bot=e}async registerSlashCommands(e,t){try{await Promise.all(t.map((async t=>{if(this.bot.config.bannedServers.includes(t.id))return;const r=this.bot.functions.getSettings(t);let o=t.preferredLocale.toLowerCase();""!==r.lngOverride&&(o=r.lngOverride),this.bot.i18.changeLanguage(o);const s=e.map((e=>(0,Command_1.translateCommand)(this.bot,e).toJSON())),n=await t.commands.set(s),i=await t.roles.fetch(),a=r.adminRoles.map((e=>i.find((t=>t.id===e)))),l=new jspteroapi_1.Client(this.bot.config.pteroHost,r.pteroClientToken,void 0,!0),d=new jspteroapi_1.Application(this.bot.config.pteroHost,r.pteroToken,void 0,!0),c=!await l.testAPI(!1),g=r.admin&&!await d.testAPI(!1),m=c||g;if(0===a.length||m){return n.find((e=>"set"===e.name))?(m&&c&&this.bot.logger.warn("Invalid client token. Set new token in server with /set as the server owner!"),m&&g&&this.bot.logger.warn("Invalid admin token. Set new token in server with /set as the server owner!"),void(0===a.length&&this.bot.logger.warn("Unable to find roles. Set roles in server with /set as the server owner!"))):this.bot.logger.error("Critical Error: 'set' command not found")}n.forEach((t=>{e.find((e=>e.name===t.name))||t.delete()}))}))),this.bot.logger.ready("Successfully registered slash commands")}catch(e){this.bot.logger.error("Unable to register commands"),console.error(e)}}}exports.Register=Register;