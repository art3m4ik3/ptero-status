"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cmd=void 0;const Command_1=require("../classes/Command"),template_1=require("../embeds/template"),run=async({bot:e,interaction:t,app:a,settings:s})=>{const i=t.options.getSubcommand(),n=t.options.getSubcommandGroup();if(t.guildId&&"server"===n)if("create"===i){const i=t.options.getString("name",!0),n=t.options.getNumber("cpu")??0,o=t.options.getNumber("memory")??0,r=t.options.getNumber("disk")??0,m=t.options.getNumber("swap")??-1,l=t.options.getNumber("database")??0,d=t.options.getNumber("allocation")??0,p=t.options.getNumber("backup")??0,u=t.options.getBoolean("autostart")??!1,c=await a.getAllNests({eggs:!0});if(0===c.length)return e.functions.handleNoResult(t,s,e.t("not_found.nest"));const b=await e.functions.selectFromArray(t,s,c,"attributes.name","attributes.id",e.t("template.sel_nest"));if(!b.attributes.relationships?.eggs?.data||!Array.isArray(b.attributes.relationships?.eggs?.data))return e.functions.handleNoResult(t,s);const g=await e.functions.selectFromArray(t,s,b.attributes.relationships.eggs.data,"attributes.name","attributes.id",e.t("template.sel_egg"),void 0,"attributes.description");if("object"==typeof g.attributes.docker_images&&(g.attributes.docker_images=Object.values(g.attributes.docker_images)),0===g.attributes.docker_images.length)return e.functions.handleNoResult(t,s);const f=await e.functions.selectFromArray(t,s,g.attributes.docker_images,"","",e.t("template.sel_docker")),N=await a.getEggInfo(b.attributes.id,g.attributes.id,{variables:!0});if(void 0===N.relationships?.variables?.data)return e.functions.handleNoResult(t,s);const _={};for(const{attributes:a}of N.relationships.variables.data){const i=await e.functions.requestFollowUp(t,s,a.name.toLocaleUpperCase(),`**${e.t("template.type_value")}\n${e.t("template.for_default",{default:"def",empty:"empty"})}**\n\n${a.description.slice(0,99)}\n\n**${e.t("template.rules").toUpperCase()}**: \`\`\`${a.rules}\`\`\`\n**${e.t("template.default_val")}**: \`\`\`${""!==a.default_value?a.default_value.toString():"â€‹"}\`\`\``,void 0,!1);_[a.env_variable]="def"===i||"cancel"===i?a.default_value:"empty"===i?"":i}const v={memory:o,cpu:n,disk:r,swap:m,database:l,allocation:d,backup:p,nest:b.attributes.id,egg:N.id,dockerImg:f,autoStart:u,env:_};e.settings.set(t.guildId,v,`serverTemplates.${i}`),await t.editReply({embeds:[(0,template_1.makeTemplateEmbed)(e,s,i,v,N)]})}else if("show"===i){const i=s.serverTemplates;if(0===Object.keys(i).length)return e.functions.handleNoResult(t,s);const n=[];for(const t in i)try{const o=await a.getEggInfo(i[t].nest,i[t].egg);n.push((0,template_1.makeTemplateEmbed)(e,s,t,i[t],o))}catch(e){}if(0===n.length)return e.functions.handleNoResult(t,s);await e.pagination.paginate(t,n)}else if("delete"===i){const a=t.options.getString("name",!0),i=s.serverTemplates;if(!Object.keys(i).includes(a))return e.functions.handleNoResult(t,s);delete i[a],e.settings.set(t.guildId,i,"serverTemplates"),await t.editReply({embeds:[e.embed({title:e.t("template.success_del")},{settings:s})]})}};exports.cmd=(new Command_1.CommandWithAdmin).setName("template").setDescription("template.main").setCategory("pterodactyl_admin").setRun(run).addSubcommandGroup((e=>e.setName("server").setDescription("template.server").addSubcommand((e=>e.setName("create").setDescription("template.create").addStringOption((e=>e.setName("name").setDescription("template.name").setRequired(!0))).addNumberOption((e=>e.setName("cpu").setDescription("template.cpu"))).addNumberOption((e=>e.setName("memory").setDescription("template.memory"))).addNumberOption((e=>e.setName("disk").setDescription("template.disk"))).addNumberOption((e=>e.setName("swap").setDescription("template.swap"))).addNumberOption((e=>e.setName("backup").setDescription("template.backup"))).addNumberOption((e=>e.setName("allocation").setDescription("template.allocation"))).addNumberOption((e=>e.setName("database").setDescription("template.database"))).addBooleanOption((e=>e.setName("autostart").setDescription("template.autostart"))))).addSubcommand((e=>e.setName("delete").setDescription("template.delete").addStringOption((e=>e.setName("name").setDescription("template.name").setRequired(!0))))).addSubcommand((e=>e.setName("show").setDescription("template.show")))));