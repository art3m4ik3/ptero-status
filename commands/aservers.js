"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cmd=void 0;const discord_js_1=require("discord.js"),powerButtons_1=require("../buttons/powerButtons"),Command_1=require("../classes/Command"),aserver_1=require("../embeds/aserver"),run=async({bot:e,app:t,client:s,settings:r,interaction:a})=>{const n=a.options.getString("name"),i=await t.getAllServers({allocations:!0,user:!0,egg:!0,databases:!0},n?{filter:n,filterBy:"name"}:void 0);if(0===i.length)return e.functions.handleNoResult(a,r,e.t("not_found.server"));const o=await Promise.all(i.map((async({attributes:t},a)=>{let n;if((0===a||1===a||a===i.length-1)&&!t.suspended)try{n=await s.getServerResources(t.identifier)}catch(e){}return(0,aserver_1.makeAServerEmbed)(e,r,t,n)}))),d=(0,powerButtons_1.powerButtonRow)(e),u=new discord_js_1.ButtonBuilder({customId:"unsuspend",style:discord_js_1.ButtonStyle.Success}).setLabel(e.t("aservers.unsuspend")),c=new discord_js_1.ButtonBuilder({customId:"reinstall",style:discord_js_1.ButtonStyle.Danger}).setLabel(e.t("aservers.reinstall")),l=new discord_js_1.ButtonBuilder({customId:"suspend",style:discord_js_1.ButtonStyle.Danger}).setLabel(e.t("aservers.suspend")),m=new discord_js_1.ActionRowBuilder({components:[u,l,c]});await e.pagination.paginate(a,o,[d,m],(async({value:n},d,{refreshEmbed:u})=>{try{const a=async(a,n=!1)=>{let d,u=i[a].attributes;if(n&&(u=await t.getServerInfo(i[a].attributes.id,{allocations:!0,user:!0,egg:!0,databases:!0})),!u.suspended)try{d=await s.getServerResources(u.identifier)}catch(e){}o[a]=(0,aserver_1.makeAServerEmbed)(e,r,u,d)};switch(d.customId){case"refresh":await a(n,!0),await u(d);break;case"reinstall":await t.reinstallServer(i[n].attributes.id);break;case"suspend":await t.suspendServer(i[n].attributes.id);break;case"unsuspend":await t.unSuspendServer(i[n].attributes.id);break;case"start":case"stop":case"restart":case"kill":await s.setPowerState(i[n].attributes.identifier,d.customId);break;case"next":case"back":await e.pagination.updateNextBack(a,d.customId,n,o.length)}}catch(t){await e.functions.handleError(a,r,t,!0)}}),(e=>"start"===e.customId||"restart"===e.customId||"stop"===e.customId||"kill"===e.customId||"reinstall"===e.customId||"suspend"===e.customId||"unsuspend"===e.customId),!0)};exports.cmd=(new Command_1.CommandWithAdmin).setName("aservers").setDescription("aservers.main").setCategory("pterodactyl_admin").setRun(run).addStringOption((e=>e.setName("name").setDescription("aservers.name")));