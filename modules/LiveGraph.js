"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const canvas_1=require("canvas"),chartjs_node_canvas_1=require("chartjs-node-canvas"),fillAraryToLength=(a,e=20,t=0)=>{for(;a.length<e;)a.push(t);return a},colorShade=(a,e)=>"#"+a.replace(/^#/,"").replace(/../g,(a=>("0"+Math.min(255,Math.max(0,parseInt(a,16)+e)).toString(16)).substr(-2)));class LiveGraph{constructor(){this.chartJSCanva=new chartjs_node_canvas_1.ChartJSNodeCanvas({width:LiveGraph.chartJSCanvaWidth,height:LiveGraph.chartJSCanvaHeight,backgroundColour:LiveGraph.chartBackgroundColour}),this.imgJoinCanva=(0,canvas_1.createCanvas)(LiveGraph.chartJSCanvaWidth,2*LiveGraph.chartJSCanvaHeight),this.chartConf=(a,e,t,r)=>{return{type:"line",options:{plugins:{legend:{position:"bottom",labels:{font:{size:35}}},tooltip:{enabled:!1}},elements:{point:{radius:0},line:{tension:.3,backgroundColor:(i=r.embedColor.toString(),s=50,"#"+i.replace(/^#/,"").replace(/../g,(a=>("0"+Math.min(255,Math.max(0,parseInt(a,16)+s)).toString(16)).substr(-2)))),borderColor:r.embedColor.toString()}},scales:{xAxes:{ticks:{display:!1},grid:{display:!1}},yAxes:{min:0,beginAtZero:!0,suggestedMax:t,grid:{drawTicks:!1,color:"rgba(229, 232, 235, 0.15)"},ticks:{font:{size:30},color:"rgb(229, 232, 235)",maxTicksLimit:5,callback:e=>"cpu"===a?`${e}% `:`${e}Mb `,..."cpu"===a?{stepSize:t/4}:{}}}}},data:{labels:Array(20).fill(""),datasets:[{label:"cpu"===a?"CPU":"Memory",fill:!0,data:fillAraryToLength(e).reverse()}]}};var i,s},this.liveGraph=async(a,e,t=0,r)=>{const i=this.chartConf(a,e,t,r);return this.chartJSCanva.renderToBuffer(i,"image/png")},this.mergeImgBufers=async a=>{const e=this.imgJoinCanva.getContext("2d");await Promise.all(a.map((async(a,t)=>{const r=await(0,canvas_1.loadImage)(a);e.drawImage(r,0,t*LiveGraph.chartJSCanvaHeight)})));const t=this.imgJoinCanva.toBuffer();return e.clearRect(0,0,this.imgJoinCanva.width,this.imgJoinCanva.height),t},this.createLiveGraph=async(a,e)=>{const t=a.systemData.map((a=>a.cpu)),r=a.systemData.map((a=>a.memory)),i=[await this.liveGraph("cpu",t,50*(a.systemHardData?.cpu??0),e),await this.liveGraph("mem",r,(a.systemHardData?.memory??0)/2,e)];return await this.mergeImgBufers(i)}}}LiveGraph.chartJSCanvaHeight=600,LiveGraph.chartJSCanvaWidth=1500,LiveGraph.chartBackgroundColour="#2f3136",exports.default=LiveGraph;